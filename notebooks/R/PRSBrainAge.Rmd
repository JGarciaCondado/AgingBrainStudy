---
title: "PRS BrainAge"
author: "Jorge Garcia Condado"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: true
    toc_float: true
knit: (
  function(inputFile, encoding) { 
    rmarkdown::render('PRSBrainAge.Rmd',
      output_file = paste('results/PRSBrainAge', '.html', sep=''))
      })
---

```{r, include = FALSE, warning = FALSE, message = FALSE}
library(ggplot2); library(ggpubr); library(dplyr);library(sjPlot)


knitr::opts_chunk$set(echo = FALSE, message = FALSE)
theme_set(theme_bw())
```

# Polygenetic Risk Score of BrainAge 

```{r, include = FALSE}

# Load PRS
prs_A4 <- read.csv('~/Documents/Projects/geneticsbrainage/data/ageml/factors/prs_0.5.csv')

# Load delta
delta_A4 <- read.csv('~/Documents/Projects/geneticsbrainage/analysis/structural_brainage/ageml/model_age/predicted_age_sex.csv')
data_A4 <- merge(prs_A4, delta_A4, by = 'BID', all.x = TRUE)

# Blood biomarkers
ptau_A4 <- read.csv('~/Documents/Projects/geneticsbrainage/data/ageml/factors/ptau217.csv')
roche_A4 <- read.csv('~/Documents/Projects/geneticsbrainage/data/ageml/factors/roche.csv')
data_A4 <- merge(data_A4, ptau_A4, by = 'BID', all.x = TRUE)
data_A4 <- merge(data_A4, roche_A4, by = 'BID', all.x = TRUE)

# Amyloid status
status <- read.csv('~/Documents/Projects/geneticsbrainage/data/A4/status.csv')
status$Amyloid <- ifelse(status$Amyloid == 1, 'positive', 'negative')
status$e4 <- ifelse(status$e4 == 1, 'carrier', 'non-carrier')
data_A4 <- merge(data_A4, status, by = 'BID', all.x = TRUE)

# Demographics
demographics <- read.csv('~/Documents/Projects/geneticsbrainage/data/SUBJINFO.csv')
demographics <- demographics %>%
  rename(YearsEd = EDCCNTU)
data_A4 <- merge(data_A4, demographics, by = 'BID', all.x = TRUE)
```

## General Linear Models with Blood Biomarkers {.tabset}

We build a general linear model that predict blood biomarkers using PRS, Age and PRS*Age interaction

### pTau217

```{r}
# pTau217
model_ptau <- glm(pTau217 ~ GM_ZSCORE*age + WM_ZSCORE*age + FC_ZSCORE*age, data = data_A4)
summary(model_ptau)
```

### tpp181
``` {r}
# tpp181
model_tpp <- glm(TPP181 ~ GM_ZSCORE*age + WM_ZSCORE*age + FC_ZSCORE*age, data = data_A4)
summary(model_tpp)
```

### NFL
``` {r}
# NFL
model_nfl <- glm(NF.L ~ GM_ZSCORE*age + WM_ZSCORE*age + FC_ZSCORE*age, data = data_A4)
summary(model_nfl)
```

### GFAP
``` {r}
# GFAP
model_gfap <- glm(GFAP ~ GM_ZSCORE*age + WM_ZSCORE*age + FC_ZSCORE*age, data = data_A4)
summary(model_gfap)
```
### AB42.AB40

``` {r}
# AB42.AB40
model_ab <- glm(AB42.AB40 ~ GM_ZSCORE*age + WM_ZSCORE*age + FC_ZSCORE*age, data = data_A4)
summary(model_ab)
```

### GFAP
``` {r}
# GFAP
model_gfap <- glm(GFAP ~GM_ZSCORE*age + WM_ZSCORE*age + FC_ZSCORE*age, data = data_A4)
summary(model_gfap)
```

## Division by E4 Status {.tabset}

### GM
```{r}
# Create a boxplot grouping by E4 status
ggplot(subset(data_A4, !is.na(e4)), aes(x = e4, y = GM_ZSCORE)) +
  geom_boxplot() +
  stat_compare_means(method = 't.test') +
  labs(title = 'PRS Zscore by E4 status',
       x = 'E4 status',
       y = 'PRS Zscore')

```

### WM
```{r}
# Create a boxplot grouping by E4 status
ggplot(subset(data_A4, !is.na(e4)), aes(x = e4, y = WM_ZSCORE)) +
  geom_boxplot() +
  stat_compare_means(method = 't.test') +
  labs(title = 'PRS Zscore by E4 status',
       x = 'E4 status',
       y = 'PRS Zscore')
```

### FC
```{r}
# Create a boxplot grouping by E4 status
ggplot(subset(data_A4, !is.na(e4)), aes(x = e4, y = FC_ZSCORE)) +
  geom_boxplot() +
  stat_compare_means(method = 't.test') +
  labs(title = 'PRS Zscore by E4 status',
       x = 'E4 status',
       y = 'PRS Zscore')
```

## Division by Amyloid Status {.tabset}

### GM
```{r}
# Create a boxplot grouping by Amyloid status

ggplot(subset(data_A4, !is.na(Amyloid)), aes(x = Amyloid, y = GM_ZSCORE)) +
  geom_boxplot() +
  stat_compare_means(method = 't.test') +
  labs(title = 'PRS Zscore by Amyloid status',
       x = 'Amyloid status',
       y = 'PRS Zscore')
```

### WM
```{r}
# Create a boxplot grouping by Amyloid status
ggplot(subset(data_A4, !is.na(Amyloid)), aes(x = Amyloid, y = WM_ZSCORE)) +
  geom_boxplot() +
  stat_compare_means(method = 't.test') +
  labs(title = 'PRS Zscore by Amyloid status',
       x = 'Amyloid status',
       y = 'PRS Zscore')
```

### FC
```{r}
# Create a boxplot grouping by Amyloid status
ggplot(subset(data_A4, !is.na(Amyloid)), aes(x = Amyloid, y = FC_ZSCORE)) +
  geom_boxplot() +
  stat_compare_means(method = 't.test') +
  labs(title = 'PRS Zscore by Amyloid status',
       x = 'Amyloid status',
       y = 'PRS Zscore')
```

## pTau217 analysis

### Individual PRS {.tabset}

#### GM
``` {r}
ggplot(subset(data_A4, !is.na(pTau217)), aes(x = GM_ZSCORE, y = pTau217)) +
  geom_point() +
  geom_smooth(method = 'lm', formula = y ~ x)+
  stat_cor() +
  labs(title = 'Comparison of PRS to pTau217 at Baseline',
       x = 'PRS Zscore',
       y = 'pTau217')

model_ptau <- glm(pTau217 ~ GM_ZSCORE*age, data = data_A4)
summary(model_ptau)
```

#### WM
``` {r}
ggplot(subset(data_A4, !is.na(pTau217)), aes(x = WM_ZSCORE, y = pTau217)) +
  geom_point() +
  geom_smooth(method = 'lm', formula = y ~ x)+
  stat_cor() +
  labs(title = 'Comparison of PRS to pTau217 at Baseline',
       x = 'PRS Zscore',
       y = 'pTau217')
model_ptau <- glm(pTau217 ~ WM_ZSCORE*age, data = data_A4)
summary(model_ptau)
```

#### FC
``` {r}
ggplot(subset(data_A4, !is.na(pTau217)), aes(x = FC_ZSCORE, y = pTau217)) +
  geom_point() +
  geom_smooth(method = 'lm', formula = y ~ x)+
  stat_cor() +
  labs(title = 'Comparison of PRS to pTau217 at Baseline',
       x = 'PRS Zscore',
       y = 'pTau217')
model_ptau <- glm(pTau217 ~ FC_ZSCORE*age, data = data_A4)
summary(model_ptau)
```

### General linear model plots


```{r}
# GLM
model_ptau <- glm(pTau217 ~ GM_ZSCORE*age + WM_ZSCORE*age + FC_ZSCORE*age, data = data_A4)
summary(model_ptau)
plot_model(model_ptau, type = c('pred'), terms = c('age', 'GM_ZSCORE'), show.values = TRUE)
plot_model(model_ptau, type = c('pred'), terms = c('age', 'WM_ZSCORE'), show.values = TRUE)
```

### Sensitivity analysis {.tabset}

We cannot include Amyloid because pTau217 is only done in amyloid positive.

#### Sex, e4 and YearsEd
```{r}
# Sensitivity analysis
model_ptau <- lm(pTau217 ~ GM_ZSCORE*age + WM_ZSCORE*age + FC_ZSCORE*age + SEX + e4 + YearsEd, data = data_A4)
summary(model_ptau)

```

#### Sex, e4 and YearsEd interaction with Age
``` {r}
# Include interaction with age
model_ptau <- lm(pTau217 ~ GM_ZSCORE*age + WM_ZSCORE*age + FC_ZSCORE*age + SEX*age + e4*age + YearsEd*age, data = data_A4)
summary(model_ptau)
```

#### Blood Biomarkers
```{r}
# Blood Biomarkers
model_ptau <- lm(pTau217 ~ GM_ZSCORE*age + WM_ZSCORE*age + FC_ZSCORE*age + NF.L + AB42.AB40 + GFAP + TPP181, data = data_A4)
summary(model_ptau)
```

#### Blood biomarkers without tpp181
```{r}
# Blood Biomarkers
model_ptau <- lm(pTau217 ~ GM_ZSCORE*age + WM_ZSCORE*age + FC_ZSCORE*age + NF.L + AB42.AB40 + GFAP, data = data_A4)
summary(model_ptau)
```