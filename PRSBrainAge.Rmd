---
title: "PRS BrainAge"
author: "Jorge Garcia Condado"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: true
    toc_float: true
knit: (
  function(inputFile, encoding) { 
    rmarkdown::render('PRSBrainAge.Rmd',
      output_file = paste('results/PRSBrainAge', '.html', sep=''))
      })
---

```{r, include = FALSE, warning = FALSE, message = FALSE}
library(ggplot2); library(ggpubr); library(dplyr);library(nlme);library(sjPlot)


knitr::opts_chunk$set(echo = FALSE, message = FALSE)
theme_set(theme_bw())
```

# Polygenetic Risk Score of BrainAge 

```{r, include = FALSE}

# Load required data
prs_A4 <- read.csv('~/Documents/Projects/geneticsbrainage/data/ageml/factors/prs_0.5.csv')
delta_A4 <- read.csv('~/Documents/Projects/geneticsbrainage/analysis/baseline/ageml/model_age/predicted_age.csv')
ptau_A4 <- read.csv('~/Documents/Projects/geneticsbrainage/data/ageml/factors/ptau217.csv')
roche_A4 <- read.csv('~/Documents/Projects/geneticsbrainage/data/ageml/factors/roche.csv')
a_e4 <- read.csv('~/Documents/Projects/geneticsbrainage/data/ageml/clinical/a_e4.csv')

# Obtain status of amyloid
a_e4$amyloid <- ifelse(a_e4$CN == 1 | a_e4$A.e4..1 == 1 , 'negative', 'positivie')
a_e4$e4 <- ifelse(a_e4$CN == 1 | a_e4$A.e4. == 1 , 'negative', 'positive')

# Merge data
data_A4 <- merge(prs_A4, delta_A4, by = 'BID', all.x = TRUE)
data_A4 <- merge(data_A4, ptau_A4, by = 'BID', all.x = TRUE)
data_A4 <- merge(data_A4, roche_A4, by = 'BID', all.x = TRUE)
data_A4 <- merge(data_A4, a_e4, by = 'BID', all.x = TRUE)
```

## Correlation with BrainAge {.tabset}

Plot correlation of PRS Zscore with BrainAge delta

### GM

```{r}
# GM
ggplot(data_A4, aes(x = GM_ZSCORE, y = delta_all)) +
  geom_point() +
  geom_smooth(method = 'lm')+
  stat_cor() +
  labs(title = 'Comparison of PRS to BrainAge at Baseline',
       x = 'PRS Zscore',
       y = 'Delta (years)')
```

### WM

```{r}
ggplot(data_A4, aes(x = WM_ZSCORE, y = delta_all)) +
  geom_point() +
  geom_smooth(method = 'lm')+
  stat_cor() +
  labs(title = 'Comparison of PRS to BrainAge at Baseline',
       x = 'PRS Zscore',
       y = 'Delta (years)')
```

### FC

```{r}
ggplot(data_A4, aes(x = FC_ZSCORE, y = delta_all)) +
  geom_point() +
  geom_smooth(method = 'lm')+
  stat_cor() +
  labs(title = 'Comparison of PRS to BrainAge at Baseline',
       x = 'PRS Zscore',
       y = 'Delta (years)')
```

## General Linear Models with Blood Biomarkers {.tabset}

We build a general linear model that predict blood biomarkers using PRS, Age and PRS*Age interaction

### pTau217

```{r}
# pTau217
model_ptau <- glm(pTau217 ~ GM_ZSCORE + WM_ZSCORE + FC_ZSCORE + age + GM_ZSCORE:age + WM_ZSCORE:age + FC_ZSCORE:age, data = data_A4)
summary(model_ptau)
```

### tpp181
``` {r}
# tpp181
model_tpp <- glm(TPP181 ~ GM_ZSCORE + WM_ZSCORE + FC_ZSCORE + age + GM_ZSCORE:age + WM_ZSCORE:age + FC_ZSCORE:age, data = data_A4)
summary(model_tpp)
```

### NFL
``` {r}
# NFL
model_nfl <- glm(NF.L ~ GM_ZSCORE + WM_ZSCORE + FC_ZSCORE + age + GM_ZSCORE:age + WM_ZSCORE:age + FC_ZSCORE:age, data = data_A4)
summary(model_nfl)
```

### GFAP
``` {r}
# GFAP
model_gfap <- glm(GFAP ~ GM_ZSCORE + WM_ZSCORE + FC_ZSCORE + age + GM_ZSCORE:age + WM_ZSCORE:age + FC_ZSCORE:age, data = data_A4)
summary(model_gfap)
```
### AB42.AB40

``` {r}
# AB42.AB40
model_ab <- glm(AB42.AB40 ~ GM_ZSCORE + WM_ZSCORE + FC_ZSCORE + age + GM_ZSCORE:age + WM_ZSCORE:age + FC_ZSCORE:age, data = data_A4)
summary(model_ab)
```

### GFAP
``` {r}
# GFAP
model_gfap <- glm(GFAP ~ GM_ZSCORE + WM_ZSCORE + FC_ZSCORE + age + GM_ZSCORE:age + WM_ZSCORE:age + FC_ZSCORE:age, data = data_A4)
summary(model_gfap)
```

## Division by E4 Status {.tabset}

### GM
```{r}
# Create a boxplot grouping by E4 status
ggplot(subset(data_A4, !is.na(e4)), aes(x = e4, y = GM_ZSCORE)) +
  geom_boxplot() +
  stat_compare_means(method = 't.test') +
  labs(title = 'PRS Zscore by E4 status',
       x = 'E4 status',
       y = 'PRS Zscore')

```

### WM
```{r}
# Create a boxplot grouping by E4 status
ggplot(subset(data_A4, !is.na(e4)), aes(x = e4, y = WM_ZSCORE)) +
  geom_boxplot() +
  stat_compare_means(method = 't.test') +
  labs(title = 'PRS Zscore by E4 status',
       x = 'E4 status',
       y = 'PRS Zscore')
```

### FC
```{r}
# Create a boxplot grouping by E4 status
ggplot(subset(data_A4, !is.na(e4)), aes(x = e4, y = FC_ZSCORE)) +
  geom_boxplot() +
  stat_compare_means(method = 't.test') +
  labs(title = 'PRS Zscore by E4 status',
       x = 'E4 status',
       y = 'PRS Zscore')
```

## Division by Amyloid Status {.tabset}

### GM
```{r}
# Create a boxplot grouping by Amyloid status

ggplot(subset(data_A4, !is.na(amyloid)), aes(x = amyloid, y = GM_ZSCORE)) +
  geom_boxplot() +
  stat_compare_means(method = 't.test') +
  labs(title = 'PRS Zscore by Amyloid status',
       x = 'Amyloid status',
       y = 'PRS Zscore')
```

### WM
```{r}
# Create a boxplot grouping by Amyloid status
ggplot(subset(data_A4, !is.na(amyloid)), aes(x = amyloid, y = WM_ZSCORE)) +
  geom_boxplot() +
  stat_compare_means(method = 't.test') +
  labs(title = 'PRS Zscore by Amyloid status',
       x = 'Amyloid status',
       y = 'PRS Zscore')
```

### FC
```{r}
# Create a boxplot grouping by Amyloid status
ggplot(subset(data_A4, !is.na(amyloid)), aes(x = amyloid, y = FC_ZSCORE)) +
  geom_boxplot() +
  stat_compare_means(method = 't.test') +
  labs(title = 'PRS Zscore by Amyloid status',
       x = 'Amyloid status',
       y = 'PRS Zscore')
```

